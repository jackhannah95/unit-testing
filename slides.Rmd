---
title: "Unit testing in R using <br> the testthat package"
subtitle: "Scottish Government R user day"
author: 'Jack Hannah <br> Information Services Division <br>'
date: "1 October 2019 <br><br> Slides: https://github.com/jackhannah95/unit-testing"
output:
  ioslides_presentation:
    widescreen: true
    css: my-theme.css
---

```{r setup, include = FALSE}
# Load packages required
library(knitr)
library(magrittr)
library(testthat)

knitr::opts_chunk$set(echo = TRUE)
```


## What is unit testing?

- Unit testing involves testing code to ensure it does what it's supposed to do

- It is an important concept in software development

- In the context of R, unit testing normally involves testing whether the output of functions are as expected

- If you've never heard of unit testing, but do write R functions, chances are you already do informal unit testing


## Why do unit testing?

```{r echo = FALSE, out.width = "85%", fig.align = 'center'}
include_graphics(here::here("images", "pill-test.jpg"))
```


## Why do unit testing?

- Provides evidence that your code works as intended - useful for anyone else who uses it, or yourself in future

- If you find a bug in the code, unit tests are a way of checking that it has been resolved

- If you make amendments to the code in future, re-running existing unit tests is a way of checking you haven't inadvertently broken anything that used to work

- Forces you to break large, unwieldy sections of code up into smaller, more manageable functions


## The testthat package

- "_Testing should be something that you do all the time, but itâ€™s normally painful and boring_" - [Hadley Wickham](https://journal.r-project.org/archive/2011-1/RJournal_2011-1_Wickham.pdf)

- The testthat package provides functions to automate unit testing

- It's designed with package development in mind, but there's no reason it can't be used to test functions in standalone scripts

```{r echo = FALSE, out.width = "25%", fig.align = 'center'}
include_graphics(here::here("images", "testthat_logo.png"))
```


## The testthat package

- The most prominent functions in testthat are the `expect_` functions:

```{r}
expect_equal(2 + 3, 5)
expect_error(sum(1, "two"))
```

If these tests are run individually and pass, they return no output. They return an error message if they fail:

```{r, error = TRUE}
expect_lt(3, 2)
```